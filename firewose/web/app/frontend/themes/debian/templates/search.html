{#
  Copyright (C) 2013  Matthieu Caneill <matthieu.caneill@gmail.com>
  License: GNU Affero General Public License, version 3 or above.
#}

{% extends "base.html" %}
{% import "macros.inc.html" as macros %}

{% block title %}Search results{% endblock %}

{% block content %}

<h2>{{ self.title() }}</h2>

<div id="rightmenu">
  <h2>Refine search</h2>
  <ul>
    {% for submenu in menu %}
        {% if submenu["active"] %}
          <h3>{{ submenu["name"] }}</h3>
          <span class="small">
            <em>{% if submenu["value"] != "" -%}
                  {{ submenu["value"] }}
              {%- else -%}
                  (blank)
              {%- endif %}</em>
            (<a href="{{ url_for('.search_html',
                                 **submenu["remove_filter"]) }}">remove</a>)
          </span>
        {% elif not(submenu["active"]) and (submenu["items"]|length > 0) %}
          <h3>{{ submenu["name"] }}</h3>
          <ul>
            {% for item in submenu["items"] %}
              <li class="small">
                <a href="{{ url_for('.search_html', **item["add_filter"]) }}">
                  {% if item["name"] -%}
                    {% if item["name"]|length >
                  config["SEARCH_MENU_MAX_NUMBER_OF_CHARS"] -%}{# long name #}
                    {{ item["name"][:config["SEARCH_MENU_MAX_NUMBER_OF_CHARS"]] }}…
                    {%- else -%}
                      {{ item["name"] }}{# short name #}
                    {%- endif %}
                  {%- else -%}
                    (blank)
                  {%- endif %}</a>
                <span>({{ item["count"] }}){# number of items #}</span>
              </li>
            {% endfor %}
            {% if submenu["is_sliced"] %}…{% endif %}
          </ul>
        {% endif %}

    {% endfor %}
  </ul>
</div>


{% if packages_suggestions %}
  <p>
  Try with these packages:
  {% for package in packages_suggestions %}
  <a href="{{ url_for(".search_html", sut_name=package.name) }}">{{
    package.name }}</a> 
  {% endfor %}
  </p>
{% endif %}

{% if results %}
  displaying {{ results_range[0] }}-{{ results_range[1] }} of
  {{ results_all_count }} results
  <ul>
  {% for res in results %}
  <li>
    <small><span class="color-{{ res["result_type"] }}">[{{ res["result_type"] }}]</span></small>
    <strong>{{ res["sut_name"] }} ({{ res["sut_version"] }})</strong> in
    {{ res["location_file"] }}
    {% if res.Range %}
      ({{ res.Range.start.line }}:{{ res.Range.start.column }}-{{
    res.Range.end.line }}:{{ res.Range.end.column }})
      {% set startline = res.Range.start.line %}
      {% set endline = res.Range.end.line %}
    {% else %}
      ({{ res.Point.line }}:{{ res.Point.column }})
      {% set startline = res.Point.line %}
      {% set endline = None %}
    {% endif %}
    :<br />
    {% if res["message_text"] %}
      {{ res["message_text"] }}
    {% else %}
      (no message)
    {% endif %}
    <small>
      <a href="{{ url_for('.result_elem_html', id=res.id)
      }}">details</a> |
      <a href="{{ url_for_source(res["sut_name"], res["sut_version"],
                                 res["sut_release"],
                                 res["location_file"], startline, endline,
                                 res["message_text"]) }}">view code</a>
    </small>
  </li>
  {% endfor %}
  </ul>
  <div id="pagination">
    Go to page: {{ macros.render_pagination(pagination) }}
  </div>
{% endif %}

{% endblock %}
