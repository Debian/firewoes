{% extends "base.html" %}
{% import "macros.inc.html" as macros %}

{% block title %}Search results{% endblock %}

{% block content %}

<h2>{{ self.title() }}</h2>

<form action="" method="get" name="directsearch" style="display: none;">
  <input type="text" name="q" value="{{ q }}" style="width: 300px;" />
  <input type="submit" value="search!" />
</form>

<form action="" method="get" name="search" style="display: none;">
  Sut.name: <input type="text" name="sut.name" value="{{
  filter['sut.name'] }}" />
  Sut.version: <input type="text" name="sut.version" value="{{
  filter['sut.version'] }}" />
  Generator.name: <input type="text" name="generator.name" value="{{
  filter['generator.name'] }}" />
  <input type="submit" value="search!" />
</form>

<div id="rightmenu">
  <h2>Precise search</h2>
  <ul>
    {% for name, type, items in precise_menu %}
        {% if type == "remove" %}
          <h3>{{ name }}</h3>
          <span class="small">
            <em>{% if items[0] != "" %}
                  {{ items[0] }}
                {% else %}
                   (blank)
              {% endif %} </em>
            (<a href="{{ url_for('.search_html', **items[1]) }}">remove</a>)
          </span>
        {% elif (type == "list") and (items|length > 0) %}
          <h3>{{ name }}</h3>
          <ul>
            {% for item in items %}
              <li class="small">
                <a href="{{ url_for('.search_html', **item[2]) }}">{# link #}
                  {% if item[0] != "" %}
                    {% if item[0]|length >
                  config["SEARCH_MENU_MAX_NUMBER_OF_CHARS"] %}{# long name #}
                    {{ item[0][:config["SEARCH_MENU_MAX_NUMBER_OF_CHARS"]] }}...
                    {% else %}
                      {{ item[0] }}{# short name #}
                    {% endif %}
                  {% else %}
                    (blank)
                  {% endif %}
                </a>
                <span>({{ item[1] }}){# number of items #}</span>
              </li>
            {% endfor %}
          </ul>
        {% endif %}

    {% endfor %}
  </ul>
</div>

{% if results %}
  {{ results|length }} results
  <ul>
  {% for res in results %}
  <li>
    <small><span class="color-{{ res["result.type"] }}">[{{ res["result.type"] }}]</span></small>
    <strong>{{ res["sut.name"] }} ({{ res["sut.version"] }})</strong> in
    {{ res["location.file"] }}
    {% if res.Range %}
      range (TODO)
    {% else %}
      ({{ res.Point.line }}:{{ res.Point.column }})
    {% endif %}
    :<br />
    {% if res["message.text"] %}
      {{ res["message.text"] }}
    {% else %}
      (no message)
    {% endif %}
    <small>
      <a href="{{ url_for('.result_elem_html', id=res.id) }}">details</a>
    </small>
  </li>
  {% endfor %}
  </ul>
{% endif %}

{% endblock %}
