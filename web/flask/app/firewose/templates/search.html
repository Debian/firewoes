{#
  Copyright (C) 2013  Matthieu Caneill <matthieu.caneill@gmail.com>
  License: GNU Affero General Public License, version 3 or above.
#}

{% extends "base.html" %}
{% import "macros.inc.html" as macros %}

{% block title %}Search results{% endblock %}

{% block content %}

<h2>{{ self.title() }}</h2>

<form action="" method="get" name="directsearch" style="display: none;">
  <input type="text" name="q" value="{{ q }}" style="width: 300px;" />
  <input type="submit" value="search!" />
</form>

<form action="" method="get" name="search" style="display: none;">
  Sut.name: <input type="text" name="sut_name" value="{{
  filter['sut_name'] }}" />
  Sut.version: <input type="text" name="sut_version" value="{{
  filter['sut_version'] }}" />
  Generator.name: <input type="text" name="generator_name" value="{{
  filter['generator_name'] }}" />
  <input type="submit" value="search!" />
</form>

<div id="rightmenu">
  <h2>Refine search</h2>
  <ul>
    {% for submenu in precise_menu %}
        {% if submenu["type"] == "remove" %}
          <h3>{{ submenu["name"] }}</h3>
          <span class="small">
            <em>{% if submenu["item"][0] != "" -%}
                  {{ submenu["item"][0] }}
              {%- else -%}
                  (blank)
              {%- endif %}</em>
            (<a href="{{ url_for('.search_html',
                                 **submenu["item"][1]) }}">remove</a>)
          </span>
        {% elif (submenu["type"] == "list") and (submenu["items"]|length > 0) %}
          <h3>{{ submenu["name"] }}</h3>
          <ul>
            {% for item in submenu["items"] %}
              <li class="small">
                <a href="{{ url_for('.search_html', **item[2]) }}">{# link #}
                  {% if item[0] != "" -%}
                    {% if item[0]|length >
                  config["SEARCH_MENU_MAX_NUMBER_OF_CHARS"] -%}{# long name #}
                    {{ item[0][:config["SEARCH_MENU_MAX_NUMBER_OF_CHARS"]] }}...
                    {%- else -%}
                      {{ item[0] }}{# short name #}
                    {%- endif %}
                  {%- else -%}
                    (blank)
                  {%- endif %}</a>
                <span>({{ item[1] }}){# number of items #}</span>
              </li>
            {% endfor %}
            {% if submenu["is_sliced"] %}...{% endif %}
          </ul>
        {% endif %}

    {% endfor %}
  </ul>
</div>


{% if packages_suggestions %}
  <p>
  Try with these packages:
  {% for package in packages_suggestions %}
  <a href="{{ url_for(".search_html", sut_name=package.name) }}">{{
    package.name }}</a> 
  {% endfor %}
  </p>
{% endif %}

{% if results %}
  displaying {{ results_range[0] }}-{{ results_range[1] }} of
  {{ results_all_count }} results
  <ul>
  {% for res in results %}
  <li>
    <small><span class="color-{{ res["result_type"] }}">[{{ res["result_type"] }}]</span></small>
    <strong>{{ res["sut_name"] }} ({{ res["sut_version"] }})</strong> in
    {{ res["location_file"] }}
    {% if res.Range %}
      range (TODO)
    {% else %}
      ({{ res.Point.line }}:{{ res.Point.column }})
    {% endif %}
    :<br />
    {% if res["message_text"] %}
      {{ res["message_text"] }}
    {% else %}
      (no message)
    {% endif %}
    <small>
      <a href="{{ url_for('.result_elem_html', id=res.id) }}">details</a>
    </small>
  </li>
  {% endfor %}
  </ul>
  <div id="pagination">
    Go to page: {{ macros.render_pagination(pagination) }}
  </div>
{% endif %}

{% endblock %}
